---
title: "Data Frame Management using dplyr"
author: "ppar"
date: "28 Oct 2015"
output:
  html_document:
    keep_md: yes
    toc: no
---
```{r echo = FALSE, results="hide"}
Sys.setlocale("LC_ALL", "C")
```
#A grammar for data manipulation
The **dplyr** package is an important tool for dealing and managing data frames. It does not provide any news functionality to R, everything that can be done with **dplyr** can be done with base R but **dplyr** does **greatly simplify** existing functionality in R.

The **dplyr** package provides a "vocabulary"/ "grammar" used for data manipulation and for operating on data frames. And **dplyr** functions are faster and more performant than base R.

##The **vocabulary**/ **grammar**: the basic elements

* [`select`](#sel)
* [`filter`](#fil) (`slice`)
* `arrange`
* `rename`
* `mutate`
* `summarize`
* `%>%`

##Installing the **dplyr** package
```{r installation, eval = FALSE}
install.packages("dplyr")
```

##Loading the **dplyr** package & the data
```{r loadPackage, warning = FALSE, message = FALSE, collapse = TRUE}
library(dplyr)
```
```{r checkVersion, collapse = TRUE}
packageVersion("dplyr")
```

Loading the data used for the code chunks.
```{r loadData, collapse = TRUE, cache = TRUE}
rawData <- read.csv("./data/stormData.csv", stringsAsFactors = FALSE)
str(rawData)
```

##<a id="sel">`select`verb</a>
The `select` function is used to select the columns of a data frame that you want to focus on.

Example 1: select cols by col numbers  
```{r selectExample1, collapse=TRUE}
#Select only the following columns 
#STATE__(1), BGN_DATE(2), BGN_TIME(3), TIME_ZONE(4), 
#COUNTY(5), COUNTYNAME(6), STATE(7), EVTYPE(8)

#Provide the column numbers
rawData.s <- select(rawData, 1:8)
str(rawData.s)
```

Example 2: select cols by col numbers (alternative)   
```{r selectExample2, collapse=TRUE}
#Select only the following columns 
#BGN_DATE(2), BGN_TIME(3), TIME_ZONE(4), 
#COUNTYNAME(6), STATE(7), EVTYPE(8)

#Provide the column numbers
rawData.s <- select(rawData, c(2,3,4,6,7,8))
str(rawData.s)
```

Example 3: select cols by col names  
```{r selectExample3, collapse=TRUE}
#Select only the following columns 
#STATE__(1), BGN_DATE(2), BGN_TIME(3), TIME_ZONE(4), 
#COUNTY(5), COUNTYNAME(6), STATE(7), EVTYPE(8)

#Provide the column names
rawData.s <- select(rawData, STATE__:EVTYPE)
str(rawData.s)
```

Example 4:  select cols by col names (alternative)  
```{r selectExample4, collapse=TRUE}
#Select only the following columns 
#STATE__(1), BGN_DATE(2) 
#EVTYPE(8)

#Provide the column names
rawData.s <- select(rawData, c(STATE__, BGN_DATE, EVTYPE))
str(rawData.s)
```

Example 5: select cols by col names (alternative)  
```{r selectExample5, collapse=TRUE}
#Remove the following columns 
#STATE__(1), BGN_DATE(2) 
#EVTYPE(8)

#Provide the column names or column numbers
#-(minus) is used to tell to remove a specific element
rawData.s <- select(rawData, c(-STATE__, -BGN_DATE, -EVTYPE))
str(rawData.s)
```

Example 6: select cols whose col names start with  
```{r selectExample6, collapse=TRUE}
#Select the columns whose names start with "BGN")

#starts_with is a special function
rawData.s <- select(rawData, starts_with("BGN"))
str(rawData.s)
```

Example 7: select cols whose col names end with  
```{r selectExample7, collapse=TRUE}
#Select the columns whose names end with "DATE")

#ends_with is a special function
rawData.s <- select(rawData, ends_with("DATE"))
str(rawData.s)
```

##<a id="fil">`filter`verb</a>
The `filter` function is used to extract a subset of rows from a data frame based on a specific logic condition.

A simple filtering ....
```{r filterExample1, collapse = TRUE}
#Unique EVTYPE values
unique(rawData$EVTYPE)

#Original dimension raw dataset
dim(rawData)

#Getting all of the observation connecte with a "TORNADO" EVTYPE
rawData.tornado <- filter(rawData, EVTYPE == "TORNADO")

#Unique EVTYPE values
unique(rawData.tornado$EVTYPE)

#Dimension filtered dataset
dim(rawData.tornado)
```

A more complex filtering ....
```{r filterExample2, collapse = TRUE}
#Unique EVTYPE values
unique(rawData$EVTYPE)

#Unique COUNTYNAME values (first 10 ...)
unique(rawData$COUNTYNAME)[1:10]

#Original dimension raw dataset
dim(rawData)

#Getting all of the observation connecte with a "TORNADO" EVTYPE and "MOBILE" COUNTYNAME
rawData.tornadoAndMobile <- filter(rawData, EVTYPE == "TORNADO" & COUNTYNAME == "MOBILE")

#Unique EVTYPE values
unique(rawData.tornadoAndMobile$EVTYPE)

#Unique COUNTYNAME values
unique(rawData.tornadoAndMobile$COUNTYNAME)

#Dimension filtered dataset
dim(rawData.tornadoAndMobile)
```